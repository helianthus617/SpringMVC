<html>
<head>
  <title>exception</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/604762 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="696"/>
<h1>exception</h1>

<div>
<span><div style="min-height: 10pt; text-align: left;"><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>      protected void doDispatch(HttpServletRequest request, HttpServletResponse response) throws Exception {</div><div>            HttpServletRequest processedRequest = request;</div><div>            HandlerExecutionChain mappedHandler = null;</div><div>            boolean multipartRequestParsed = false;</div><div>            WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);</div><div>            try {</div><div>                  ModelAndView mv = null;</div><div>                  Exception dispatchException = null;</div><div>                  try {</div><div>                        processedRequest = checkMultipart(request);</div><div>                        multipartRequestParsed = processedRequest != request;</div><div>                        // Determine handler for the current request.</div><div>                        mappedHandler = getHandler(processedRequest);</div><div>                        if (mappedHandler == null || mappedHandler.getHandler() == null) {</div><div>                              noHandlerFound(processedRequest, response);</div><div>                              return;</div><div>                        }</div><div>                        // Determine handler adapter for the current request.</div><div>                        HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());</div><div>                        // Process last-modified header, if supported by the handler.</div><div>                        String method = request.getMethod();</div><div>                        boolean isGet = &quot;GET&quot;.equals(method);</div><div>                        if (isGet || &quot;HEAD&quot;.equals(method)) {</div><div>                              long lastModified = ha.getLastModified(request, mappedHandler.getHandler());</div><div>                              if (logger.isDebugEnabled()) {</div><div>                                    String requestUri = urlPathHelper.getRequestUri(request);</div><div>                                    logger.debug(&quot;Last-Modified value for [&quot; + requestUri + &quot;] is: &quot; + lastModified);</div><div>                              }</div><div>                              if (new ServletWebRequest(request, response).checkNotModified(lastModified) &amp;&amp; isGet) {</div><div>                                    return;</div><div>                              }</div><div>                        }</div><div>                        if (!mappedHandler.applyPreHandle(processedRequest, response)) {</div><div>                              return;</div><div>                        }</div><div>                        try {</div><div>                              // Actually invoke the handler.</div><div>                        <b><font color="#FF0000">      mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</font></b></div><div>                        }</div><div>                        finally {</div><div>                              if (asyncManager.isConcurrentHandlingStarted()) {</div><div>                                    return;</div><div>                              }</div><div>                        }</div><div>                        applyDefaultViewName(request, mv);</div><div>                        mappedHandler.applyPostHandle(processedRequest, response, mv);</div><div>                  }</div><div>                  catch (Exception ex) {</div><div>                    <b><font color="#E30000">    dispatchException = ex;</font></b></div><div>                  }</div><div>                <b><font color="#E30000">  processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);</font></b></div><div>}</div><div>           <b><font color="#FF0000"> catch (Exception ex) {</font></b></div><div><b><font color="#FF0000">                  triggerAfterCompletion(processedRequest, response,  mappedHandler, ex);</font></b></div><div><b><font color="#FF0000">            }</font></b></div><div>            catch (Error err) {</div><div>                  triggerAfterCompletionWithError(processedRequest,  response, mappedHandler, err);</div><div>            }</div><div><b><font color="#E30000"><br/></font></b></div><div><b><font color="#E30000"><br/></font></b></div><div><b><font color="#E30000"><br/></font></b></div><div><b><font color="#E30000"><br/></font></b></div><div><b><font color="#E30000"><br/></font></b></div><div><b><font color="#E30000"><br/></font></b></div><div><b><font color="#E30000"><br/></font></b></div><div><b><font color="#E30000"><br/></font></b></div><div>private void <b><font color="#FF0000">processDispatchResult</font></b>(HttpServletRequest request,  HttpServletResponse response,</div><div>                  HandlerExecutionChain mappedHandler, ModelAndView mv,  Exception exception) throws Exception {</div><div>            boolean errorView = false;</div><div>            if (exception != null) {</div><div>                <b><font color="#FF0000">  if (exception instanceof  ModelAndViewDefiningException) {</font></b></div><div>                        logger.debug(&quot;ModelAndViewDefiningException  encountered&quot;, exception);</div><div>                        mv = ((ModelAndViewDefiningException)  exception).getModelAndView();</div><div>                  }</div><div>                  else {</div><div>                        Object handler = (mappedHandler != null ?  mappedHandler.getHandler() : null);</div><div>                       <b><font color="#FF0000"> mv = processHandlerException(request, response,  handler, exception);</font></b></div><div>                        errorView = (mv != null);</div><div>                  }</div><div>            }</div><div>            // Did the handler return a view to render?</div><div>            if (mv != null &amp;&amp; !mv.wasCleared()) {</div><div>                 <b><font color="#FF4635"> render(mv, request, response);</font></b></div><div>                  if (errorView) {</div><div>                        WebUtils.clearErrorRequestAttributes(request);</div><div>                  }</div><div>            }</div><div>            else {</div><div>                  if (logger.isDebugEnabled()) {</div><div>                        logger.debug(&quot;Null ModelAndView returned to  DispatcherServlet with name '&quot; + getServletName() +</div><div>                                    &quot;': assuming HandlerAdapter  completed request handling&quot;);</div><div>                  }</div><div>            }</div><div>            if  (WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) {</div><div>                  // Concurrent handling started during a forward</div><div>                  return;</div><div>            }</div><div>            if (mappedHandler != null) {</div><div>                  mappedHandler.triggerAfterCompletion(request,  response, null);</div><div>            }</div><div>      }</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>protected ModelAndView <font color="#FF0000"><b>processHandlerException</b></font>(HttpServletRequest  request, HttpServletResponse response,</div><div>                  Object handler, Exception ex) throws Exception {</div><div>            // Check registered HandlerExceptionResolvers...</div><div>            ModelAndView exMv = null;</div><div><b><font color="#FF0000">//如果异常处理器都不能处理,则抛出这些异常</font></b></div><div>         <b><font color="#E30000">   for (HandlerExceptionResolver handlerExceptionResolver :  this.handlerExceptionResolvers) {</font></b></div><div><b><font color="#E30000">                  exMv =  handlerExceptionResolver.resolveException(request, response, handler,  ex);</font></b></div><div><b><font color="#E30000">                  if (exMv != null) {</font></b></div><div><b><font color="#E30000">                        break;</font></b></div><div><b><font color="#E30000">                  }</font></b></div><div><b><font color="#E30000">            }</font></b></div><div>            if (exMv != null) {</div><div>                  if (exMv.isEmpty()) {</div><div>                        return null;</div><div>                  }</div><div>                  // We might still need view name translation for a  plain error model...</div><div>                  if (!exMv.hasView()) {</div><div>                        exMv.setViewName(getDefaultViewName(request));</div><div>                  }</div><div>                  if (logger.isDebugEnabled()) {</div><div>                        logger.debug(&quot;Handler execution resulted in  exception - forwarding to resolved error view: &quot; + exMv, ex);</div><div>                  }</div><div>                  WebUtils.exposeErrorRequestAttributes(request, ex,  getServletName());</div><div>                  return exMv;</div><div>            }</div><div>            throw ex;</div><div>      }</div></div><div style="min-height: 10pt; text-align: left;"><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><b><font color="#FF0000">DefaultHandlerExceptionResolver:默认异常解析器</font></b></div><div>try {</div><div>                  if (ex instanceof  NoSuchRequestHandlingMethodException) {</div><div>                        return  handleNoSuchRequestHandlingMethod((NoSuchRequestHandlingMethodException)  ex, request, response,</div><div>                                    handler);</div><div>                  }</div><div>                  else if (ex instanceof  HttpRequestMethodNotSupportedException) {</div><div>                        return  handleHttpRequestMethodNotSupported((HttpRequestMethodNotSupportedException) ex, request,</div><div>                                    response, handler);</div><div>                  }</div><div>                  else if (ex instanceof  HttpMediaTypeNotSupportedException) {</div><div>                        return  handleHttpMediaTypeNotSupported((HttpMediaTypeNotSupportedException) ex,  request, response,</div><div>                                    handler);</div><div>                  }</div><div>                  else if (ex instanceof  HttpMediaTypeNotAcceptableException) {</div><div>                        return  handleHttpMediaTypeNotAcceptable((HttpMediaTypeNotAcceptableException)  ex, request, response,</div><div>                                    handler);</div><div>                  }</div><div>                  else if (ex instanceof  MissingServletRequestParameterException) {</div><div>                        return  handleMissingServletRequestParameter((MissingServletRequestParameterException) ex, request,</div><div>                                    response, handler);</div><div>                  }</div><div>                  else if (ex instanceof ServletRequestBindingException)  {</div><div>                        return  handleServletRequestBindingException((ServletRequestBindingException)  ex, request, response,</div><div>                                    handler);</div><div>                  }</div><div>                  else if (ex instanceof  ConversionNotSupportedException) {</div><div>                        return  handleConversionNotSupported((ConversionNotSupportedException) ex,  request, response, handler);</div><div>                  }</div><div>                  else if (ex instanceof TypeMismatchException) {</div><div>                        return  handleTypeMismatch((TypeMismatchException) ex, request, response,  handler);</div><div>                  }</div><div>                  else if (ex instanceof  HttpMessageNotReadableException) {</div><div>                        return  handleHttpMessageNotReadable((HttpMessageNotReadableException) ex,  request, response, handler);</div><div>                  }</div><div>                  else if (ex instanceof  HttpMessageNotWritableException) {</div><div>                        return  handleHttpMessageNotWritable((HttpMessageNotWritableException) ex,  request, response, handler);</div><div>                  }</div><div>                  else if (ex instanceof  MethodArgumentNotValidException) {</div><div>                        return  handleMethodArgumentNotValidException((MethodArgumentNotValidException)  ex, request, response, handler);</div><div>                  }</div><div>                  else if (ex instanceof  MissingServletRequestPartException) {</div><div>                        return  handleMissingServletRequestPartException((MissingServletRequestPartException) ex, request, response, handler);</div><div>                  }</div><div>                  else if (ex instanceof BindException) {</div><div>                        return handleBindException((BindException) ex,  request, response, handler);</div><div>                  }</div><div>                  else if (ex instanceof NoHandlerFoundException) {</div><div>                        return  handleNoHandlerFoundException((NoHandlerFoundException) ex, request,  response, handler);</div><div>                  }</div><div>            }</div></div><div style="min-height: 10pt; text-align: left;"><br/></div></span>
</div></body></html> 